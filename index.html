<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Quiz Bíblico - Citas</title>
<style>
  /* Estilos básicos, puedes adaptar */
  body { font-family: Arial, sans-serif; background: #fff8e1; color: #333; padding: 20px; }
  #quiz-container { max-width: 700px; margin: auto; background: #fff; padding: 20px; border-radius: 8px; box-shadow: 0 0 10px #ccc; }
  .opcion { margin: 5px 0; }
  button { margin-top: 10px; padding: 10px 20px; font-size: 16px; cursor: pointer; }
  #resultado-final { font-weight: bold; margin-top: 20px; }
  /* Agrega más estilos según necesites */
</style>
</head>
<body>

<div id="quiz-container">
  <h2>Quiz Bíblico - Selecciona un Bloque</h2>
  <select id="select-bloque">
    <option value="1">Bloque 1</option>
    <option value="2">Bloque 2</option>
    <!-- Agrega más bloques si tienes -->
  </select>
  <button id="btn-iniciar">Iniciar Quiz</button>

  <div id="pregunta-container" style="display:none;">
    <p id="texto-cita"></p>

    <div>
      <p>¿De qué libro es esta cita?</p>
      <div id="opciones-libro"></div>
    </div>

    <div>
      <p>¿Cuál es el capítulo?</p>
      <div id="opciones-capitulo"></div>
    </div>

    <button id="btn-siguiente" disabled>Siguiente</button>
    <p id="temporizador"></p>
  </div>

  <div id="resultado-final" style="display:none;"></div>
  <button id="btn-reiniciar" style="display:none;">Reiniciar</button>
</div>

<script>
// Variables globales
let datos = [];
let preguntasBloque = [];
let indicePregunta = 0;
let aciertosLibro = 0;
let aciertosCapitulo = 0;

const selectBloque = document.getElementById('select-bloque');
const btnIniciar = document.getElementById('btn-iniciar');
const contenedorPregunta = document.getElementById('pregunta-container');
const textoCita = document.getElementById('texto-cita');
const opcionesLibroDiv = document.getElementById('opciones-libro');
const opcionesCapituloDiv = document.getElementById('opciones-capitulo');
const btnSiguiente = document.getElementById('btn-siguiente');
const temporizadorP = document.getElementById('temporizador');
const resultadoFinalDiv = document.getElementById('resultado-final');
const btnReiniciar = document.getElementById('btn-reiniciar');

// Cargar JSON externo
async function cargarDatos() {
  try {
    const res = await fetch('citas.json');
    if (!res.ok) throw new Error('No se pudo cargar citas.json');
    datos = await res.json();
  } catch (e) {
    alert('Error al cargar datos: ' + e.message);
  }
}

// Mostrar pregunta actual
function mostrarPregunta() {
  btnSiguiente.disabled = true;
  temporizadorP.textContent = '';
  const pregunta = preguntasBloque[indicePregunta];
  textoCita.textContent = pregunta.cita;

  // Mostrar opciones de libro
  opcionesLibroDiv.innerHTML = '';
  pregunta.opciones_libro.forEach((libro, i) => {
    const label = document.createElement('label');
    label.classList.add('opcion');
    label.innerHTML = `
      <input type="radio" name="libro" value="${libro}">
      ${libro}
    `;
    opcionesLibroDiv.appendChild(label);
  });

  // Mostrar opciones de capítulo
  opcionesCapituloDiv.innerHTML = '';
  pregunta.opciones_capitulo.forEach((cap, i) => {
    const label = document.createElement('label');
    label.classList.add('opcion');
    label.innerHTML = `
      <input type="radio" name="capitulo" value="${cap}">
      ${cap}
    `;
    opcionesCapituloDiv.appendChild(label);
  });

  // Agregar eventos para habilitar botón "Siguiente" cuando ambas opciones estén seleccionadas
  const radiosLibro = opcionesLibroDiv.querySelectorAll('input[name="libro"]');
  const radiosCapitulo = opcionesCapituloDiv.querySelectorAll('input[name="capitulo"]');

  function validarSeleccion() {
    const libroSeleccionado = [...radiosLibro].some(r => r.checked);
    const capituloSeleccionado = [...radiosCapitulo].some(r => r.checked);
    btnSiguiente.disabled = !(libroSeleccionado && capituloSeleccionado);
  }

  radiosLibro.forEach(r => r.addEventListener('change', validarSeleccion));
  radiosCapitulo.forEach(r => r.addEventListener('change', validarSeleccion));
}

// Al iniciar el quiz
btnIniciar.addEventListener('click', () => {
  const bloqueSeleccionado = parseInt(selectBloque.value, 10);
  preguntasBloque = datos.filter(p => p.bloque === bloqueSeleccionado);
  if (preguntasBloque.length === 0) {
    alert('No hay preguntas para este bloque.');
    return;
  }
  indicePregunta = 0;
  aciertosLibro = 0;
  aciertosCapitulo = 0;

  document.getElementById('select-bloque').style.display = 'none';
  btnIniciar.style.display = 'none';
  resultadoFinalDiv.style.display = 'none';
  btnReiniciar.style.display = 'none';

  contenedorPregunta.style.display = 'block';
  mostrarPregunta();
});

// Al dar click en siguiente pregunta
btnSiguiente.addEventListener('click', () => {
  const pregunta = preguntasBloque[indicePregunta];

  // Obtener respuesta seleccionada libro
  const libroSeleccionado = document.querySelector('input[name="libro"]:checked').value;
  if (libroSeleccionado === pregunta.libro) aciertosLibro++;

  // Obtener respuesta seleccionada capítulo
  const capituloSeleccionado = Number(document.querySelector('input[name="capitulo"]:checked').value);
  if (capituloSeleccionado === pregunta.capitulo) aciertosCapitulo++;

  indicePregunta++;

  if (indicePregunta >= preguntasBloque.length) {
    // Terminar quiz
    contenedorPregunta.style.display = 'none';
    mostrarResultadoFinal();
  } else {
    mostrarPregunta();
  }
});

function mostrarResultadoFinal() {
  const total = preguntasBloque.length;
  const porcentajeLibro = Math.round((aciertosLibro / total) * 100);
  const porcentajeCapitulo = Math.round((aciertosCapitulo / total) * 100);

  let mensaje = `Resultados:\nLibros correctos: ${porcentajeLibro}%\nCapítulos correctos: ${porcentajeCapitulo}%`;

  if (porcentajeLibro > 80 && porcentajeCapitulo > 80) {
    mensaje += '\n¡Excelente conocimiento bíblico!';
  } else if (porcentajeLibro > 50 || porcentajeCapitulo > 50) {
    mensaje += '\nBuen trabajo, sigue estudiando.';
  } else {
    mensaje += '\nNecesitas mejorar el estudio de la Biblia.';
  }

  resultadoFinalDiv.textContent = mensaje;
  resultadoFinalDiv.style.display = 'block';
  btnReiniciar.style.display = 'inline-block';
}

// Reiniciar el quiz
btnReiniciar.addEventListener('click', () => {
  document.getElementById('select-bloque').style.display = 'inline-block';
  btnIniciar.style.display = 'inline-block';
  resultadoFinalDiv.style.display = 'none';
  btnReiniciar.style.display = 'none';
  contenedorPregunta.style.display = 'none';
});

window.onload = () => {
  cargarDatos();
};
</script>

</body>
</html>
