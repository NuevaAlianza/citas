<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Quiz Bíblico por Bloques</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #fff7e6;
      color: #5a3e1b;
      margin: 0;
      padding: 20px;
    }

    .container {
      max-width: 650px;
      margin: 0 auto;
      background-color: #f9f3e7;
      border: 2px solid #d2b48c;
      border-radius: 8px;
      padding: 20px;
    }

    h1, h2, h3 {
      text-align: center;
      color: #a05a0a;
    }

    .menu-bloques {
      margin-bottom: 20px;
      text-align: center;
    }

    #pregunta {
      font-size: 1.2rem;
      font-style: italic;
      text-align: center;
      margin-bottom: 20px;
    }

    .opciones {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      justify-content: center;
      margin-bottom: 20px;
    }

    button.opcion {
      background-color: #d2b48c;
      border: none;
      padding: 10px 15px;
      border-radius: 5px;
      cursor: pointer;
      color: #5a3e1b;
      font-weight: bold;
      transition: background-color 0.3s;
      flex: 1 1 40%;
      min-width: 120px;
    }

    button.opcion:hover {
      background-color: #a05a0a;
      color: white;
    }

    #mensaje-final {
      text-align: center;
      font-weight: bold;
      font-size: 1.2rem;
      margin-top: 20px;
    }

    #btn-volver-inicio {
      margin-top: 15px;
      background-color: #a05a0a;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 5px;
      cursor: pointer;
      font-weight: bold;
    }

    #btn-volver-inicio:hover {
      background-color: #5a3e1b;
    }

    @media (max-width: 500px) {
      button.opcion {
        flex: 1 1 100%;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <h2>Selecciona un Bloque</h2>
    <div class="menu-bloques">
      <select id="selector-bloques"></select>
      <button id="btn-comenzar">Comenzar</button>
    </div>

    <div id="quiz" style="display: none;">
      <div id="pregunta"></div>
      <div class="opciones" id="opciones"></div>
    </div>

    <div id="mensaje-final" style="display: none;"></div>
  </div>

  <script>
    let datosQuiz = [];
    let preguntas = [];
    let indice = 0;
    let pasoLibro = true;

    // Contadores de aciertos
    let aciertosLibro = 0;
    let aciertosCapitulo = 0;

    async function cargarDatos() {
      try {
        const res = await fetch('citas.json');
        datosQuiz = await res.json();
        const bloques = [...new Set(datosQuiz.map(p => p.bloque))];
        const selector = document.getElementById('selector-bloques');
        selector.innerHTML = '<option value="">-- Elige un bloque --</option>';
        bloques.forEach(b => {
          const option = document.createElement('option');
          option.value = b;
          option.textContent = `Bloque ${b}`;
          selector.appendChild(option);
        });
      } catch (err) {
        alert("Error cargando citas.json");
      }
    }

    function mezclar(array) {
      return array.sort(() => Math.random() - 0.5);
    }

    function mostrarPregunta() {
      const quiz = document.getElementById('quiz');
      const contenedor = document.getElementById('opciones');
      const cita = preguntas[indice];
      contenedor.innerHTML = "";
      document.getElementById('pregunta').textContent = `"${cita.cita}"`;

      const opciones = pasoLibro
        ? mezclar(cita.opciones_libro)
        : mezclar(cita.opciones_capitulo.map(c => String(c)));

      opciones.forEach(opcion => {
        const btn = document.createElement('button');
        btn.className = 'opcion';
        btn.textContent = opcion;
        btn.onclick = () => evaluarRespuesta(opcion);
        contenedor.appendChild(btn);
      });

      quiz.style.display = 'block';
    }

    function evaluarRespuesta(opcion) {
      const actual = preguntas[indice];
      if (pasoLibro) {
        if (opcion === actual.libro) {
          aciertosLibro++;
          alert("✅ Libro correcto. Ahora el capítulo.");
        } else {
          alert(`❌ Era: ${actual.libro}. Ahora el capítulo.`);
        }
        pasoLibro = false;
        mostrarPregunta();
      } else {
        if (parseInt(opcion) === actual.capitulo) {
          aciertosCapitulo++;
          alert("✅ Capítulo correcto. Siguiente cita.");
        } else {
          alert(`❌ Era: ${actual.capitulo}. Siguiente cita.`);
        }
        indice++;
        pasoLibro = true;
        if (indice < preguntas.length) {
          mostrarPregunta();
        } else {
          mostrarResultadoFinal();
        }
      }
    }

    function mostrarResultadoFinal() {
      document.getElementById('quiz').style.display = 'none';

      const total = preguntas.length;
      const porcentajeLibros = Math.round((aciertosLibro / total) * 100);
      const porcentajeCapitulos = Math.round((aciertosCapitulo / total) * 100);
      const promedio = Math.round((porcentajeLibros + porcentajeCapitulos) / 2);

      let mensajeNivel = '';
      if (promedio >= 90) {
        mensajeNivel = '¡Excelente! Eres un experto en las citas bíblicas.';
      } else if (promedio >= 70) {
        mensajeNivel = 'Muy bien, tienes buen conocimiento, pero puedes mejorar.';
      } else if (promedio >= 50) {
        mensajeNivel = 'Está bien, pero te recomiendo seguir practicando.';
      } else {
        mensajeNivel = 'Necesitas estudiar más para mejorar tus respuestas.';
      }

      const contenedorFinal = document.getElementById('mensaje-final');
      contenedorFinal.innerHTML = `
        <h2>¡Has terminado el bloque!</h2>
        <p>✅ Aciertos en LIBROS: ${aciertosLibro} / ${total} (${porcentajeLibros}%)</p>
        <p>✅ Aciertos en CAPÍTULOS: ${aciertosCapitulo} / ${total} (${porcentajeCapitulos}%)</p>
        <p><strong>${mensajeNivel}</strong></p>
        <button id="btn-volver-inicio">Volver al inicio</button>
      `;
      contenedorFinal.style.display = 'block';

      // Mostrar el selector de bloques para volver a empezar
      document.querySelector('.menu-bloques').style.display = 'block';

      // Agregar evento para reiniciar
      document.getElementById('btn-volver-inicio').addEventListener('click', reiniciar);
    }

    function comenzarQuiz() {
      const bloque = document.getElementById('selector-bloques').value;
      if (!bloque) return alert("Selecciona un bloque primero");
      preguntas = datosQuiz.filter(p => p.bloque == bloque);
      indice = 0;
      pasoLibro = true;
      aciertosLibro = 0;
      aciertosCapitulo = 0;
      document.querySelector('.menu-bloques').style.display = 'none';
      document.getElementById('mensaje-final').style.display = 'none';
      mostrarPregunta();
    }

    function reiniciar() {
      indice = 0;
      pasoLibro = true;
      aciertosLibro = 0;
      aciertosCapitulo = 0;
      preguntas = [];
      document.getElementById('mensaje-final').style.display = 'none';
      document.getElementById('quiz').style.display = 'none';
      document.querySelector('.menu-bloques').style.display = 'block';
      document.getElementById('pregunta').textContent = '';
      document.getElementById('opciones').innerHTML = '';
      document.getElementById('selector-bloques').value = "";
    }

    document.getElementById('btn-comenzar').addEventListener('click', comenzarQuiz);
    cargarDatos();
  </script>
</body>
</html>
